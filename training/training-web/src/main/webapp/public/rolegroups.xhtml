<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" template="/templates/masterLayout.xhtml"
	xmlns:sec="http://www.springframework.org/security/tags">
	
	<ui:define name="content">
	<h:form id="roleform">
	<p:messages id="msgs" />
	<p:dataTable id="rolegrouptable"
				 value="#{roleGroupsBean.allRoleGroup}"
				 var="rolegroup"
				 selectionMode="single"
				 selection="#{roleGroupsBean.selectedRoleGroup}"
				 rowKey="#{rolegroup.id}"
				 paginator="true"
				 rows="12"
				 rowsPerPageTemplate="4,8,12">
	
				<p:column headerText="id">
					<h:outputText value="#{rolegroup.id}">
					</h:outputText>
				</p:column>
				<p:column headerText="modDate">
					<h:outputText value="#{rolegroup.modDate}">
						<f:convertDateTime pattern="yyyy-MM-dd HH:mm:ss" />
					</h:outputText>
				</p:column>
				<p:column headerText="modUser">
					<h:outputText value="#{rolegroup.modUser}">
					</h:outputText>
				</p:column>
				<p:column headerText="name">
					<h:outputText value="#{rolegroup.name}">
					</h:outputText>
				</p:column>
				<p:column headerText="recDate">
					<h:outputText value="#{rolegroup.recDate}">
						<f:convertDateTime pattern="yyyy-MM-dd HH:mm:ss" />
					</h:outputText>
				</p:column>
				<p:column headerText="recUser">
					<h:outputText value="#{rolegroup.recUser}">
					</h:outputText>
				</p:column>
<!-- 				Valahogy meg kellene oldani hogy a jogcsoporthoz tartozó jogokat is meg tudja jelenítani -->
				<p:column headerText="roles">
					<p:dataList value="#{rolegroup.roles}" var="role" >
        				#{role.name}
    				</p:dataList>
				</p:column>
				
				
				<f:facet name="footer">
				<!-- Create -->
					<p:commandButton styleClass="btn" icon="ui-icon-plusthick"
									value="Create role group"
									onclick="PF('createDialog').show();" />
				<!-- Edit -->
					<p:commandButton id="editButton" icon="ui-icon-pencil"
									process="rolegrouptable" 
									disabled="#{roleGroupsBean.disabled}"
									value="Edit selected role group" 
									onclick="PF('editDialog').show();" />
				<!-- Delete -->
					<p:commandButton id="deleteButton" icon="ui-icon-trash"
									process="rolegrouptable"
									update="growl,:roleform:rolegrouptable"
									disabled="#{roleGroupsBean.disabled}"
									value="Delete Selected group"
									action="#{roleGroupsBean.delete()}" >
						
						<p:confirm icon="ui-icon-alert"
								  header="Delete Role Group" 
								  message="Are you sure you want to delete?" /> 
					</p:commandButton>
					
					<p:commandButton id="manageRoles" icon="ui-icon-pencil"
									 process="rolegrouptable"
									 update="growl,:roleform:rolegrouptable"
									 value="Manage roles"
									 onclick="PF('manageDialog').show();">
					
					</p:commandButton>
				</f:facet>
				<p:ajax event="rowSelect" 
				listener="#{roleGroupsBean.onRowSelect}" 
				update="growl,editButton,deleteButton,:pickform:pickList" />
				
			</p:dataTable>
			</h:form>
			
			<p:confirmDialog global="true" responsive="true" showEffect="clip">
				<p:commandButton value="Yes" type="button" update="growl,:roleform:rolegrouptable" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
				<p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
			</p:confirmDialog>
			
			<p:dialog header="Create new Role Group" widgetVar="createDialog" modal="true" height="100"
						resizable="false" draggable="false" responsive="true" >
    			<h:form id="newrolegroup" styleClass="form-horizontal" >
    				<div class="form-group">
						<label for="rolegroupname" class="col-sm-3">Role Group name</label>
						<div class="col-sm-9">
							<p:inputText styleClass="form-control" id="rolegroupname"
								value="#{roleGroupsBean.roleGroupName}" required="true"
								label="rolegroupname">
							</p:inputText>
						</div>
					</div>
					<p:commandButton styleClass="btn" value="Save" update="growl,:roleform:rolegrouptable"
					action="#{roleGroupsBean.create}" icon="ui-icon-check" oncomplete="closeCreateDialog()"/>
    			</h:form>
    			<script type="text/javascript">
    				function closeCreateDialog() {
            			PF('createDialog').hide();
    				}
				</script>
			</p:dialog>  
			
			<p:dialog header="Edit Role Group" widgetVar="editDialog" modal="true" height="100"
						resizable="false" draggable="false" responsive="true" >
    			<h:form id="editrolegroup" styleClass="form-horizontal" >
    				<div class="form-group">
						<label for="rolegroupname" class="col-sm-3">Role Group name</label>
						<div class="col-sm-9">
							<p:inputText styleClass="form-control" id="rolegroupname"
								value="#{roleGroupsBean.roleGroupName}" required="true"
								label="rolegroupname">
							</p:inputText>
						</div>
					</div>
					<p:commandButton styleClass="btn" value="Save" update="growl,:roleform:rolegrouptable"
					action="#{roleGroupsBean.edit}" icon="ui-icon-check" oncomplete="closeEditDialog()"/>
    			</h:form>
    			<script type="text/javascript">
    				function closeEditDialog() {
            			PF('editDialog').hide();
    				}
				</script>
			</p:dialog>   
			
			<p:dialog header="Manage Roles" widgetVar="manageDialog" modal="true" 
						resizable="false" draggable="false" responsive="true" >
    				<h:form id="pickform">
	    				<p:pickList id="pickList" 
		    				value="#{roleGroupsBean.selectedRoleGroup_sRoles}" 
		    				var="roles"
		    				itemValue="#{roles}"
		    				itemLabel="#{roles.name}"
		    				converter="RoleConverter">
			
	    				
	    				</p:pickList>
    				
	    				<p:commandButton styleClass="btn" value="Save" update="growl,:roleform:rolegrouptable"
						action="#{roleGroupsBean.saveManaged}" icon="ui-icon-check" oncomplete="closeManageDialog()"/>
    				</h:form>
    				
    				<script type="text/javascript">
    				function closeManageDialog() {
            			PF('manageDialog').hide();
    				}
				</script>
			</p:dialog>  
	
	</ui:define>
	
</ui:composition>